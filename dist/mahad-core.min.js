(t=>{const e=0,i=1,s=2,n=Symbol("data_to"),r=Symbol("data_to_field"),o=Symbol("logger"),d=(t,e)=>i=>{const s=Symbol();return t.push([i,s]),i.listen(s,e)},h=Object.getOwnPropertyDescriptors(class{get[n](){if(this[r])return this[r];{const t=Array(3).fill(0).map((t=>new Map));return this[r]=t,t}}modify(...t){return this.edit([0,...t])}listen(t,e){return this.set_to(t,{[s]:e},null,!1),this}unlisten(t){this.unset_to(t,!1)}unguard(t){this.unset_to(t)}bind_from(t,e,i){return this.clear(),t.set_to(this,e,i),this}unbind_from(t){this.unset_to(t)}bind_clone(t){return this.bind_from(t,{[s]:(t,e,i,s)=>{e.edit(...s)}})}make_bind(t,e){return(new this.constructor).bind_from(this,t,e)}bind_trans(t,e){const i=[],n=()=>{i[0]?.forEach((([t,e])=>t.unlisten(e)));const s=[],r=d(s,n);this.assign(e(t,r)),i[0]=s};return this.bind_from(t,{[s]:n},i)}bmap(t){return(new this.constructor).bind_map(this,t)}bfilter(t){return(new this.constructor).bind_filter(this,t)}breduce(t,e){return(new this.constructor).bind_reduce(this,t,e)}bclone(){return(new this.constructor).bind_clone(this)}btrans(t,e){return t.bind_trans(this,e)}}.prototype);delete h.constructor,t.MahadArray=class extends Array{static unfold(t,e){const i=new this;for(;;){let s;if([t,s]=e(t),void 0===s)break;i.push(s)}return i.reverse()}get val(){return this[0]}num_sorted(){return this.toSorted(((t,e)=>t-e))}edit(...t){const e=this[n];let i=null;for(const s of t){const[t,n]=s;switch(t){case 0:const t=this.splice(n,s[2],...s[3]);for(const[i,[n,r]]of e[0])n(this,i,r,s,t,s[3]);i=t;break;case 1:const r=this.splice(n,s[2]);this.splice(n+s[3],0,...r);for(const[t,[i,n]]of e[1])i(this,t,n,s,r)}}for(const[i,[s,n]]of[...e[2]])s(this,i,n,t);return i}move(...t){return this.edit([1,...t])}move_at(t,e,i){return this.move(this.indexOf(t),e,i)}move_before(t,e,i){return this.move(this.indexOf(t)-e,e,i)}move_after(t,e,i){return this.move(this.indexOf(t)+1,e,i)}move_range(t,e,i){const s=this.indexOf(t),n=this.indexOf(e)+1;return this.move(s,n-s,i)}exchange(t,e,i=void 0,s=void 0){let n,r,o,d=this.indexOf(t);return void 0===i?(n=d+1,r=this.indexOf(e),o=r+1):void 0===s?(n=this.indexOf(e)+1,r=this.indexOf(i),o=r+1):(n=this.indexOf(e)+1,r=this.indexOf(i),o=this.indexOf(s)+1),[d,n,r,o]=[d,n,r,o].sort(),n===r?this.move(d,n-d,o-r):this.edit([1,d,n-d,r-n],[1,r,o-r,d-r])}modify_at(t,e,i){return this.modify(this.indexOf(t),e,i)}modify_before(t,e,i){return this.modify(this.indexOf(t)-e,e,i)}modify_after(t,e,i){return this.modify(this.indexOf(t)+1,e,i)}modify_range(t,e,i){const s=this.indexOf(t),n=this.indexOf(e)+1;return this.modify(s,n-s,i)}delete(t,e=1){return this.modify(t,e,[])}delete_at(t,e=1){return this.indexOf(t)>=0?this.delete(this.indexOf(t),e):[]}prefix(...t){return this.modify(0,0,t)}suffix(...t){return this.modify(this.length,0,t)}unprefix(t){return this.delete(0,t)}unsuffix(t){return this.delete(this.length-t,t)}assign(t){return this.modify(0,this.length,t)}set(t,e){return this.modify(t,1,[e])}set val(t){this.modify(0,1,[t])}toggle(t){if(void 0!==t){const e=this.indexOf(t);e>=0?this.delete(e):this.suffix(t)}else this.val=!this.val}clear(){return this.modify(0,this.length,[])}set_to(t,e,i=[],s=!0){const r=this[n];for(const s in e)r[s].set(t,[e[s],i]);if(s){const s=[0,0,0,this];e[0]?.(this,t,i,s,[],this),e[2]?.(this,t,i,[s])}}unset_to(t,e=!0){if(e){const e=[0,0,this.length,[]],i=this[n][0].get(t);if(i){const[s,n]=i;s(this,t,n,e,this,[])}const s=this[n][2].get(t);if(s){const[i,n]=s;i(this,t,n,[e])}}for(const e of this[n])e.delete(t)}blogger(){const t=t=>console.log([...t]);return t(this),this.listen(o,t)}guard(t,i,s){return this.set_to(t,{[e]:(t,e,n,[,r],o,d)=>{if(s)for(let t=o.length-1;t>=0;t--)s(o[t],r+t);if(i)for(let t=0;t<d.length;t++)i(d[t],r+t)}}),this}bind_keys(t){return this.bind_from(t,{[e]:(t,e,i,[,s],n,r)=>{void 0!==n&&void 0===r&&e.delete_at(s),void 0!==r&&void 0===n&&e.suffix(s)}})}bind_values(t){return this.bind_from(t,{[e]:(t,e,i,s,n,r)=>{void 0!==n&&e.delete_at(n),void 0!==r&&e.suffix(r)}})}bind_map(t,s){const n=[].guard(null,null,(t=>t.forEach((([t,e])=>t.unlisten(e)))));return this.bind_from(t,{[i]:(t,e,i,s)=>{e.edit(s),i.edit(s)},[e]:(t,e,i,[,n,r,o])=>{const h=[];e.modify(n,r,o.map(((t,r)=>{const o=n+r,f=[],c=()=>{const n=[];e.set(o,s(t,o,d(n,c))),i.set(o,n)},u=s(t,o,d(f,c));return h.push(f),u}))),i.modify(n,r,h)}},n)}bind_filter(t,i){const s=new Map,n=(t,e)=>{s.set(t,e)},r=t=>{for(const e of s.get(t)??[])for(const[t,i]of e)t.unlisten(i);s.delete(t)};return this.bind_from(t,{[e]:(t,e,s,[,o],h,f)=>{for(const t of h)e.delete_at(t),r(t);f.forEach(((t,s)=>{const h=o+s,f=()=>{r(t);const s=[],o=i(t,h,d(s,f)),c=e.includes(t);o&&!c?e.suffix(t):!o&&c&&e.delete_at(t),n(t,s)};f()}))}},s)}bind_flat(t){const i=[].guard(null,null,(([t,e])=>t.unlisten(e))),n=()=>{this.assign(t.flat(1))};return this.bind_from(t,{[e]:(t,e,i,[,s,r,o])=>{i.modify(s,r,o.map((t=>{const e=Symbol();return t.listen(e,n),[t,e]})))},[s]:n},i)}bind_reduce(t,i,s){const n=[],r=()=>{n[0]?.forEach((([t,e])=>t.unlisten(e)));const e=[],o=d(e,r);this.val=t.reduce(((t,e,s)=>i(t,e,s,o)),s),n[0]=e};return this.bind_from(t,{[e]:r},n)}bind_sort(t,i){const s=[],n=()=>{s[0]?.forEach((([t,e])=>t.unlisten(e)));const e=[],r=d(e,n);this.assign(t.toSorted(((t,e)=>i(t,e,r)))),s[0]=e};return this.bind_from(t,{[e]:n},s)}bflat(){return(new this.constructor).bind_flat(this)}bsort(t){return(new this.constructor).bind_sort(this,t)}},Object.defineProperties(MahadArray.prototype,h);const f=Object.getOwnPropertyDescriptors(MahadArray.prototype);delete f.constructor,Array.unfold=MahadArray.unfold,Object.defineProperties(Array.prototype,f),t.MahadObject=class extends Object{static unfold(t,e){const i=new this;for(;;){let s;if([t,k,s]=e(t),void 0===s)break;i[k]=s}return i}reduce(t,e){const i=Object.entries(this);e??=i.pop();for(const[s,n]of i)e=t.call(this,e,n,s);return e}edit(...t){const e=this[n];let i=null;for(const s of t){const[t,n,r]=s;if(0===t){const t=this[n];void 0!==r?this[n]=r:delete this[n];for(const[i,[n,o]]of e[0])n(this,i,o,s,t,r);i=t}}for(const[i,[s,n]]of[...e[2]])s(this,i,n,t);return i}delete(...t){return this.edit(...t.map((t=>[0,t,void 0])))}assign(t){return this.edit(...Object.entries(this).map((([t])=>[0,t,void 0])),...Object.entries(t).map((([t,e])=>[0,t,e])))}merge(t){return this.edit(...Object.entries(t).map((([t,e])=>[0,t,e])))}clear(){return this.edit(...Object.entries(this).map((([t])=>[0,t,void 0])))}set_to(t,e,i=[],s=!0){const r=this[n];for(const s in e)r[s].set(t,[e[s],i]);if(s){const s=Object.entries(this).map((([t,e])=>[0,t,e]));for(const n of s)e[0]?.(this,t,i,n,void 0,n[2]);e[2]?.(this,t,i,s)}}unset_to(t,e=!0){if(e){const e=Object.entries(this).map((([t,e])=>[[0,t,void 0],e])),i=this[n][0].get(t);if(i){const[s,n]=i;for(const[i,r]of e)s(this,t,n,i,r,void 0)}const s=this[n][2].get(t);if(s){const[i,n]=s;i(this,t,n,e.map((t=>t[0])))}}for(const e of this[n])e.delete(t)}blogger(){const t=t=>{const e={};for(const i in t)e[i]=t[i];console.log(e)};return t(this),this.listen(o,t)}guard(t,i,s){return this.set_to(t,{[e]:(t,e,n,[,r],o,d)=>{s&&void 0!==o&&s(o,r),i&&void 0!==d&&i(d,r)}}),this}bind_map(t,i){const s={}.guard(null,null,(t=>t.forEach((([t,e])=>t.unlisten(e)))));return this.bind_from(t,{[e]:(t,e,s,[,n,r])=>{if(void 0!==r){const t=[],o=()=>{const t=[];e.modify(n,i(r,n,d(t,o))),s.modify(n,t)};e.modify(n,i(r,n,d(t,o))),s.modify(n,t)}else e.modify(n,r),s.modify(n,r)}},s)}bind_filter(t,i){const s={}.guard(null,null,(t=>t.forEach((([t,e])=>t.unlisten(e)))));return this.bind_from(t,{[e]:(t,e,s,[,n],r,o)=>{if(void 0!==r&&(e.delete(n),s.delete(n)),void 0!==o){const t=()=>{const r=[],h=i(o,n,d(r,t)),f=n in e;h&&!f?e.modify(n,o):!h&&f&&e.delete(n),s.modify(n,r)};t()}}},s)}bind_reduce(t,e,i){const n=[],r=()=>{n[0]?.forEach((([t,e])=>t.unlisten(e)));const s=[],o=d(s,r);this.val=t.reduce(((t,i,s)=>e(t,i,s,o)),i),n[0]=s};return this.bind_from(t,{[s]:r},n)}bkeys(){return(new Array).bind_keys(this)}bvalues(){return(new Array).bind_values(this)}},Object.defineProperties(MahadObject.prototype,h);const c=Object.getOwnPropertyDescriptors(MahadObject.prototype);delete c.constructor,Object.unfold=MahadObject.unfold,Object.defineProperties(Object.prototype,c)})(globalThis);