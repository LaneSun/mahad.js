(t=>{const e=0,s=1,i=2,n=Symbol("data_to"),r=Symbol("data_to_field"),o=(t,e)=>s=>{const i=Symbol();return t.push([s,i]),s.listen(i,e)},h=Object.getOwnPropertyDescriptors(class{get[n](){if(this[r])return this[r];{const t=Array(3).fill(0).map((t=>new Map));return this[r]=t,t}}modify(...t){return this.edit([0,...t])}listen(t,e){return this.set_to(t,{[i]:e},null,!1),this}unlisten(t){this.unset_to(t,!1)}unguard(t){this.unset_to(t)}bind_from(t,e,s){return this.clear(),t.set_to(this,e,s),this}unbind_from(t){this.unset_to(t)}bind_clone(t){return this.bind_from(t,{[i]:(t,e,s,i)=>{e.edit(...i)}})}make_bind(t,e){return(new this.constructor).bind_from(this,t,e)}bclone(){return(new this.constructor).bind_clone(this)}}.prototype);delete h.constructor,t.MahadArray=class extends Array{static unfold(t,e){const s=new this;for(;;){let i;if([t,i]=e(t),void 0===i)break;s.push(i)}return s.reverse()}get val(){return this[0]}edit(...t){const e=this[n];let s=null;for(const i of t){const[t,n]=i;switch(t){case 0:const t=this.splice(n,i[2],...i[3]);for(const[s,[n,r]]of e[0])n(this,s,r,i,t,i[3]);s=t;break;case 1:const r=this.splice(n,i[2]);this.splice(n+i[3],0,...r);for(const[t,[s,n]]of e[1])s(this,t,n,i,r)}}for(const[s,[i,n]]of[...e[2]])i(this,s,n,t);return s}move(...t){return this.edit([1,...t])}move_at(t,e,s){return this.move(this.indexOf(t),e,s)}move_before(t,e,s){return this.move(this.indexOf(t)-e,e,s)}move_after(t,e,s){return this.move(this.indexOf(t)+1,e,s)}move_range(t,e,s){const i=this.indexOf(t),n=this.indexOf(e)+1;return this.move(i,n-i,s)}exchange(t,e,s=void 0,i=void 0){let n,r,o,h=this.indexOf(t);return void 0===s?(n=h+1,r=this.indexOf(e),o=r+1):void 0===i?(n=this.indexOf(e)+1,r=this.indexOf(s),o=r+1):(n=this.indexOf(e)+1,r=this.indexOf(s),o=this.indexOf(i)+1),[h,n,r,o]=[h,n,r,o].sort(),n===r?this.move(h,n-h,o-r):this.edit([1,h,n-h,r-n],[1,r,o-r,h-r])}modify_at(t,e,s){return this.modify(this.indexOf(t),e,s)}modify_before(t,e,s){return this.modify(this.indexOf(t)-e,e,s)}modify_after(t,e,s){return this.modify(this.indexOf(t)+1,e,s)}modify_range(t,e,s){const i=this.indexOf(t),n=this.indexOf(e)+1;return this.modify(i,n-i,s)}delete(t,e=1){return this.modify(t,e,[])}delete_at(t,e=1){return this.indexOf(t)>=0?this.delete(this.indexOf(t),e):[]}prefix(...t){return this.modify(0,0,t)}suffix(...t){return this.modify(this.length,0,t)}unprefix(t){return this.delete(0,t)}unsuffix(t){return this.delete(this.length-t,t)}assign(t){return this.modify(0,this.length,t)}set(t,e){return this.modify(t,1,[e])}set val(t){this.modify(0,1,[t])}toggle(t){if(void 0!==t){const e=this.indexOf(t);e>=0?this.delete(e):this.suffix(t)}else this.val=!this.val}clear(){return this.modify(0,this.length,[])}set_to(t,e,s=[],i=!0){const r=this[n];for(const i in e)r[i].set(t,[e[i],s]);if(i){const i=[0,0,0,this];e[0]?.(this,t,s,i,[],this),e[2]?.(this,t,s,[i])}}unset_to(t,e=!0){if(e){const e=[0,0,this.length,[]],s=this[n][0].get(t);if(s){const[i,n]=s;i(this,t,n,e,this,[])}const i=this[n][2].get(t);if(i){const[s,n]=i;s(this,t,n,[e])}}for(const e of this[n])e.delete(t)}guard(t,s,i){return this.set_to(t,{[e]:(t,e,n,[,r],o,h)=>{if(i)for(let t=o.length-1;t>=0;t--)i(o[t],r+t);if(s)for(let t=0;t<h.length;t++)s(h[t],r+t)}}),this}bind_values(t){return this.bind_from(t,{[e]:(t,e,s,i,n,r)=>{void 0!==n&&e.delete_at(n),void 0!==r&&e.suffix(r)}})}bind_map(t,i){const n=[].guard(null,null,(t=>t.forEach((([t,e])=>t.unlisten(e)))));return this.bind_from(t,{[s]:(t,e,s,i)=>{e.edit(i),s.edit(i)},[e]:(t,e,s,[,n,r,h])=>{const d=[];e.modify(n,r,h.map(((t,r)=>{const h=n+r,c=[],a=()=>{const n=[];e.set(h,i(t,h,o(n,a))),s.set(h,n)},f=i(t,h,o(c,a));return d.push(c),f}))),s.modify(n,r,d)}},n)}bind_flat(t){const s=[].guard(null,null,(([t,e])=>t.unlisten(e))),n=()=>{this.assign(t.flat(1))};return this.bind_from(t,{[e]:(t,e,s,[,i,r,o])=>{s.modify(i,r,o.map((t=>{const e=Symbol();return t.listen(e,n),[t,e]})))},[i]:n},s)}bind_reduce(t,s,i){const n=[],r=()=>{n[0]?.forEach((([t,e])=>t.unlisten(e)));const e=[],h=o(e,r);this.val=t.reduce(((t,e,i)=>s(t,e,i,h)),i),n[0]=e};return this.bind_from(t,{[e]:r},n)}bind_sort(t,s){const i=[],n=()=>{i[0]?.forEach((([t,e])=>t.unlisten(e)));const e=[],r=o(e,n);this.assign(t.toSorted(((t,e)=>s(t,e,r)))),i[0]=e};return this.bind_from(t,{[e]:n},i)}bflat(){return(new this.constructor).bind_flat(this)}bmap(t){return(new this.constructor).bind_map(this,t)}breduce(t,e){return(new this.constructor).bind_reduce(this,t,e)}bsort(t){return(new this.constructor).bind_sort(this,t)}},Object.defineProperties(MahadArray.prototype,h);const d=Object.getOwnPropertyDescriptors(MahadArray.prototype);delete d.constructor,Array.unfold=MahadArray.unfold,Object.defineProperties(Array.prototype,d),t.MahadObject=class extends Object{static unfold(t,e){const s=new this;for(;;){let i;if([t,k,i]=e(t),void 0===i)break;s[k]=i}return s}reduce(t,e){const s=Object.entries(this);e??=s.pop();for(const[i,n]of s)e=t.call(this,e,n,i);return e}edit(...t){const e=this[n];let s=null;for(const i of t){const[t,n,r]=i;if(0===t){const t=this[n];void 0!==r?this[n]=r:delete this[n];for(const[s,[n,o]]of e[0])n(this,s,o,i,t,r);s=t}}for(const[s,[i,n]]of[...e[2]])i(this,s,n,t);return s}delete(...t){return this.edit(t.map((t=>[0,t,void 0])))}assign(t){return this.edit(...Object.entries(this).map((([t])=>[0,t,void 0])),...Object.entries(t).map((([t,e])=>[0,t,e])))}clear(){return this.edit(...Object.entries(this).map((([t])=>[0,t,void 0])))}set_to(t,e,s=[],i=!0){const r=this[n];for(const i in e)r[i].set(t,[e[i],s]);if(i){const i=Object.entries(this).map((([t,e])=>[0,t,e]));for(const n of i)e[0]?.(this,t,s,n,void 0,n[2]);e[2]?.(this,t,s,i)}}unset_to(t,e=!0){if(e){const e=Object.entries(this).map((([t,e])=>[[0,t,void 0],e])),s=this[n][0].get(t);if(s){const[i,n]=s;for(const[s,r]of e)i(this,t,n,s,r,void 0)}const i=this[n][2].get(t);if(i){const[s,n]=i;s(this,t,n,e.map((t=>t[0])))}}for(const e of this[n])e.delete(t)}guard(t,s,i){return this.set_to(t,{[e]:(t,e,n,[,r],o,h)=>{i&&void 0!==o&&i(o,r),s&&void 0!==h&&s(h,r)}}),this}bind_map(t,s){const i={}.guard(null,null,(t=>t.forEach((([t,e])=>t.unlisten(e)))));return this.bind_from(t,{[e]:(t,e,i,[,n,r])=>{if(void 0!==r){const t=[],h=()=>{const t=[];e.modify(n,s(r,n,o(t,h))),i.modify(n,t)};e.modify(n,s(r,n,o(t,h))),i.modify(n,t)}else e.modify(n,r),i.modify(n,r)}},i)}bind_reduce(t,e,s){const n=[],r=()=>{n[0]?.forEach((([t,e])=>t.unlisten(e)));const i=[],h=o(i,r);this.val=t.reduce(((t,s,i)=>e(t,s,i,h)),s),n[0]=i};return this.bind_from(t,{[i]:r},n)}bvalues(){return(new Array).bind_values(this)}bmap(t){return(new this.constructor).bind_map(this,t)}breduce(t,e){return(new this.constructor).bind_reduce(this,t,e)}},Object.defineProperties(MahadObject.prototype,h);const c=Object.getOwnPropertyDescriptors(MahadObject.prototype);delete c.constructor,Object.unfold=MahadObject.unfold,Object.defineProperties(Object.prototype,c)})(globalThis),(t=>{const e={apply:(t,e,s)=>{const i=new MahadElem;return s.length&&i.attr("inner",s),i},get:(t,e)=>{const i=()=>{};return i.ename=e,i.attrs=[],new Proxy(i,s)}},s={apply:(t,e,s)=>{const i=new MahadElem(t.ename);s.length&&i.attr("inner",s);for(const[e,s]of t.attrs)i.attr(e,s);return i},get:(t,e)=>(...i)=>{const n=()=>{};return n.ename=t.ename,n.attrs=e.startsWith("$")?t.attrs.concat([[e.slice(1),i[0]]]):t.attrs.concat([[e,i]]),new Proxy(n,s)}};t.ME=new Proxy((()=>{}),e);const i=Symbol("mahad"),n={id:t=>[e=>t.id=e],title:t=>[e=>t.title=e],text:t=>[e=>t.textContent=e],class:t=>[e=>t.classList.add(e),e=>t.classList.remove(e)],src:t=>[e=>t.src=e],show:t=>[e=>{t.hidden=!e,e?t.classList.remove("f-hide"):t.classList.add("f-hide")}],value:(t,e)=>(t.addEventListener("change",(()=>{e.val=t.value})),[e=>t.value=e]),style:t=>[(e,s)=>{e instanceof Array?e.guard(t,(e=>t.style.setProperty(s,e))):t.style.setProperty(s,e)},(e,s)=>{e instanceof Array&&e.unset_to(t),t.style.removeProperty(s)}],on:t=>[(e,s)=>{e instanceof Array?e.guard(t,(e=>t.addEventListener(s,e))):t.addEventListener(s,e)},(e,s)=>{e instanceof Array?e.unguard(t):t.removeEventListener(s,e)}],inner:t=>[(e,s)=>{const i=r(e);s===t.childNodes.length?t.append(i):t.insertBefore(i,t.childNodes[s])},(e,s)=>{t.childNodes[s].remove()}]},r=t=>{if(t instanceof MahadElem)return t.elem;if(t instanceof Node)return t;if(globalThis.jQuery&&t instanceof jQuery)return t[0];if(t instanceof Promise){const e=o();return t.then((t=>e.replaceWith(r(t)))),e}return"object"!=typeof t?new Text(t):void 0},o=()=>document.createElement("div");t.MahadElem=class t extends MahadObject{constructor(t="div"){super(),this.name=t,this.elem=document.createElement(this.name),this.elem[i]=this}attr(t,e=[""]){if(t in this)return this[t];{const s=n[t];return s&&this.modify(t,e.guard(null,...s(this.elem,e))),e}}attach(e){if("string"==typeof e)document.querySelector(e).append(this.elem);else if(e instanceof HTMLElement)e.append(this.elem);else if(e instanceof t)e.attr("inner").suffix(this);else{if(!(globalThis.jQuery&&e instanceof jQuery))throw"Unexpect attach target";e.append(this.elem)}}}})(globalThis);